
# https://github.com/ibraheemdev/matchit
routes:
  - route:
      type: host
      value: localhost # domain.com|domain2.com|domain3.com
    name: http-route-1

    middleware:
      - plugin: RequestHeaderModifier
        payload:
          remove:
            - x-version
          set:
            - name: x-hb-conf
              value: "prefix->${env(HOMEBREW_PREFIX)}-${or(env(MY_APP_NAME), 'default')}"
            - name: x-request-id
              value: "${uuid(v7)}"
            - name: x-timestamp
              value: "${timestamp()}"
            - name: x-forwarded-for
              value: "${var(client_ip)}-${eq(var(client_ip), '127.0.0.1', 'local')}"
            - name: x-host
              value: "${header(host)}"

      - plugin: ResponseHeaderModifier
        payload:
          set:
            - name: x-request-id-false
              value: "${or(header(x-request-id-false), concat('foo', '-', uuid(v4)))}"
            - name: x-request-id
              value: "${header(x-request-id)}"
            - name: x-server
              value: ${or(env(SERVER_NAME), 'my-server')}

    paths:
      - path: 
          - /
          - /{*path}
        methods:
          - GET
          - POST
          - OPTIONS
        service:
          name: http-service
      - path: /api/v1/{name}
        middleware:
          - plugin: RequestHeaderModifier
            payload:
              set:
                - name: x-route-name
                  value: "path 2"
        service:
          name: http-service


  - route:
      type: header
      value: my-svc
    name: http-route-2
    paths:
      - path: /{*path}
        service:
          name: http-service-2
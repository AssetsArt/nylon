header_selector: x-nylon-proxy

plugins:
  - name: plugin_sdk
    type: ffi
    file: ./target/examples/go/plugin_sdk.so
    config:
      debug: true

services:
  - name: http-service
    service_type: http
    algorithm: round_robin # Options: round_robin, random, consistent, weighted
    endpoints:
      - ip: 127.0.0.1
        port: 3001
        # weight: 10 # Optional
      - ip: 127.0.0.1
        port: 3002
        # weight: 1 # Optional


middleware_groups:
  example:
    - plugin: plugin_sdk
      entry: "authz"
      payload:
        client_ip: "${request(client_ip)}"

    - plugin: plugin_sdk
      entry: "stream"


    # - plugin: RequestHeaderModifier
    #   payload:
    #     remove:
    #       - x-version
    #     set:
    #       - name: x-hb-conf
    #         value: "prefix->${env(HOMEBREW_PREFIX)}-${or(env(MY_APP_NAME), 'default')}"
    #       - name: x-request-id
    #         value: "${uuid(v7)}"
    #       - name: x-timestamp
    #         value: "${timestamp()}"
    #       - name: x-forwarded-for
    #         value: "${request(client_ip)}-${eq(request(client_ip), '127.0.0.1', 'local')}"
    #       - name: x-host
    #         value: "${header(host)}"

    # - plugin: ResponseHeaderModifier
    #   payload:
    #     set:
    #       - name: x-request-id-false
    #         value: "${or(header(x-request-id-false), concat('foo', '-', uuid(v4)))}"
    #       - name: x-request-id
    #         value: "${header(x-request-id)}"
    #       - name: x-server
    #         value: ${or(env(SERVER_NAME), 'my-server')}
